<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="erp.chain.mapper.PackageMapper" >
  <resultMap id="BaseResultMap" type="erp.chain.domain.Goods" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Nov 04 15:05:01 CST 2016.
    -->
    <id column="id" property="id" jdbcType="BIGINT" />
    <result column="tenant_id" property="tenantId" jdbcType="BIGINT" />
    <result column="branch_id" property="branchId" jdbcType="BIGINT" />
    <result column="category_id" property="categoryId" jdbcType="BIGINT" />
    <result column="category_name" property="categoryName" jdbcType="VARCHAR" />
    <result column="goods_code" property="goodsCode" jdbcType="CHAR" />
    <result column="goods_name" property="goodsName" jdbcType="VARCHAR" />
    <result column="short_name" property="shortName" jdbcType="VARCHAR" />
    <result column="goods_unit_id" property="goodsUnitId" jdbcType="BIGINT" />
    <result column="goods_unit_name" property="goodsUnitName" jdbcType="VARCHAR" />
    <result column="bar_code" property="barCode" jdbcType="VARCHAR" />
    <result column="mnemonic" property="mnemonic" jdbcType="VARCHAR" />
    <result column="west_name" property="westName" jdbcType="VARCHAR" />
    <result column="spec" property="spec" jdbcType="VARCHAR" />
    <result column="sale_price" property="salePrice" jdbcType="DECIMAL" />
    <result column="vip_price" property="vipPrice" jdbcType="DECIMAL" />
    <result column="vip_price2" property="vipPrice2" jdbcType="DECIMAL" />
    <result column="goods_status" property="goodsStatus" jdbcType="TINYINT" />
    <result column="is_dsc" property="isDsc" jdbcType="BIT" />
    <result column="is_lowerfee" property="isLowerfee" jdbcType="BIT" />
    <result column="is_temp" property="isTemp" jdbcType="BIT" />
    <result column="is_giveticket" property="isGiveticket" jdbcType="BIT" />
    <result column="is_useticket" property="isUseticket" jdbcType="BIT" />
    <result column="is_score" property="isScore" jdbcType="BIT" />
    <result column="score_value" property="scoreValue" jdbcType="DECIMAL" />
    <result column="is_changeprice" property="isChangeprice" jdbcType="BIT" />
    <result column="is_modifynum" property="isModifynum" jdbcType="BIT" />
    <result column="is_revised_price" property="isRevisedPrice" jdbcType="BIT" />
    <result column="takeout_price" property="takeoutPrice" jdbcType="DECIMAL" />
    <result column="photo" property="photo" jdbcType="VARCHAR" />
    <result column="goods_desc" property="goodsDesc" jdbcType="VARCHAR" />
    <result column="tag" property="tag" jdbcType="VARCHAR" />
    <result column="is_servicefee" property="isServicefee" jdbcType="BIT" />
    <result column="is_sertc" property="isSertc" jdbcType="BIT" />
    <result column="is_saletc" property="isSaletc" jdbcType="BIT" />
    <result column="sale_tctype" property="saleTctype" jdbcType="TINYINT" />
    <result column="sale_tcrate" property="saleTcrate" jdbcType="DECIMAL" />
    <result column="sale_tctotal" property="saleTctotal" jdbcType="DECIMAL" />
    <result column="is_muchspec" property="isMuchspec" jdbcType="BIT" />
    <result column="weight" property="weight" jdbcType="DECIMAL" />
    <result column="is_store" property="isStore" jdbcType="BIT" />
    <result column="price_type" property="priceType" jdbcType="TINYINT" />
    <result column="is_weigh" property="isWeigh" jdbcType="BIT" />
    <result column="is_for_points" property="isForPoints" jdbcType="BIT" />
    <result column="points_value" property="pointsValue" jdbcType="DECIMAL" />
    <result column="is_ranked" property="isRanked" jdbcType="BIT" />
    <result column="is_recommended" property="isRecommended" jdbcType="BIT" />
    <result column="memo" property="memo" jdbcType="VARCHAR" />
    <result column="create_by" property="createBy" jdbcType="VARCHAR" />
    <result column="create_at" property="createAt" jdbcType="TIMESTAMP" />
    <result column="last_update_by" property="lastUpdateBy" jdbcType="VARCHAR" />
    <result column="last_update_at" property="lastUpdateAt" jdbcType="TIMESTAMP" />
    <result column="is_deleted" property="isDeleted" jdbcType="BIT" />
    <result column="goods_type" property="goodsType" jdbcType="TINYINT" />
    <result column="is_hotgood" property="isHotgood" jdbcType="BIT" />
    <result column="is_newgood" property="isNewgood" jdbcType="BIT" />
    <result column="is_takeout" property="isTakeout" jdbcType="BIT" />
    <result column="is_take" property="isTake" jdbcType="BIT" />
    <result column="is_order" property="isOrder" jdbcType="BIT" />
    <result column="is_here" property="isHere" jdbcType="BIT" />
    <result column="instore_code" property="instoreCode" jdbcType="CHAR" />
    <result column="mini_order_num" property="miniOrderNum" jdbcType="INTEGER" />
    <result column="spec_group_id" property="specGroupId" jdbcType="BIGINT" />
    <result column="purchasing_price" property="purchasingPrice" jdbcType="DECIMAL" />
    <result column="shipping_price1" property="shippingPrice1" jdbcType="DECIMAL" />
    <result column="shipping_price2" property="shippingPrice2" jdbcType="DECIMAL" />
    <result column="is_pricetag" property="isPricetag" jdbcType="TINYINT" />
    <result column="is_custom_price" property="isCustomPrice" jdbcType="BIT" />
    <result column="version" property="version" jdbcType="BIGINT" />
    <result column="brand_id" property="brandId" jdbcType="BIGINT" />
    <result column="local_id" property="localId" jdbcType="BIGINT" />
    <result column="sale_open_price" property="saleOpenPrice" jdbcType="DECIMAL" />
    <result column="combination_type" property="combinationType" jdbcType="TINYINT" />
  </resultMap>

  <insert id="insert" parameterType="map" useGeneratedKeys="true" keyProperty="id">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Nov 04 15:05:01 CST 2016.
    -->
    insert into goods (id, tenant_id, branch_id,
    category_id, category_name, goods_code,
    goods_name, short_name, goods_unit_id,
    goods_unit_name, bar_code, mnemonic,
    west_name, spec, sale_price,
    vip_price, vip_price2, goods_status,
    is_dsc, is_lowerfee, is_temp, is_giveticket,
    is_useticket, is_score, score_value,
    is_changeprice, is_modifynum, is_revised_price,
    takeout_price, photo, goods_desc,
    tag, is_servicefee, is_sertc,
    is_saletc, sale_tctype, sale_tcrate,
    sale_tctotal, is_muchspec, weight,
    is_store, price_type, is_weigh,
    is_for_points, points_value, is_ranked,
    is_recommended, memo, create_by,
    create_at, last_update_by, last_update_at,
    is_deleted, goods_type, is_hotgood,
    is_newgood, is_takeout, is_take, is_order,
    is_here, instore_code, mini_order_num,
    spec_group_id, purchasing_price, shipping_price1,
    shipping_price2, is_pricetag, is_custom_price,
    version, brand_id, local_id,
    sale_open_price,combination_type)
    values (#{id,jdbcType=BIGINT}, #{tenantId,jdbcType=BIGINT}, #{branchId,jdbcType=BIGINT},
    #{categoryId,jdbcType=BIGINT}, #{categoryName,jdbcType=VARCHAR}, #{goodsCode,jdbcType=CHAR},
    #{goodsName,jdbcType=VARCHAR}, #{shortName,jdbcType=VARCHAR}, #{goodsUnitId,jdbcType=BIGINT},
    #{goodsUnitName,jdbcType=VARCHAR}, #{barCode,jdbcType=VARCHAR}, #{mnemonic,jdbcType=VARCHAR},
    #{westName,jdbcType=VARCHAR}, #{spec,jdbcType=VARCHAR}, #{salePrice,jdbcType=DECIMAL},
    #{vipPrice,jdbcType=DECIMAL}, #{vipPrice2,jdbcType=DECIMAL}, #{goodsStatus,jdbcType=TINYINT},
    #{isDsc,jdbcType=BIT}, #{isLowerfee,jdbcType=BIT}, #{isTemp,jdbcType=BIT}, #{isGiveticket,jdbcType=BIT},
    #{isUseticket,jdbcType=BIT}, #{isScore,jdbcType=BIT}, #{scoreValue,jdbcType=DECIMAL},
    #{isChangeprice,jdbcType=BIT}, #{isModifynum,jdbcType=BIT}, #{isRevisedPrice,jdbcType=BIT},
    #{takeoutPrice,jdbcType=DECIMAL}, #{photo,jdbcType=VARCHAR}, #{goodsDesc,jdbcType=VARCHAR},
    #{tag,jdbcType=VARCHAR}, #{isServicefee,jdbcType=BIT}, #{isSertc,jdbcType=BIT},
    #{isSaletc,jdbcType=BIT}, #{saleTctype,jdbcType=TINYINT}, #{saleTcrate,jdbcType=DECIMAL},
    #{saleTctotal,jdbcType=DECIMAL}, #{isMuchspec,jdbcType=BIT}, #{weight,jdbcType=DECIMAL},
    #{isStore,jdbcType=BIT}, #{priceType,jdbcType=TINYINT}, #{isWeigh,jdbcType=BIT},
    #{isForPoints,jdbcType=BIT}, #{pointsValue,jdbcType=DECIMAL}, #{isRanked,jdbcType=BIT},
    #{isRecommended,jdbcType=BIT}, #{memo,jdbcType=VARCHAR}, #{createBy,jdbcType=VARCHAR},
    #{createAt,jdbcType=TIMESTAMP}, #{lastUpdateBy,jdbcType=VARCHAR}, #{lastUpdateAt,jdbcType=TIMESTAMP},
    #{isDeleted,jdbcType=BIT}, #{goodsType,jdbcType=TINYINT}, #{isHotgood,jdbcType=BIT},
    #{isNewgood,jdbcType=BIT}, #{isTakeout,jdbcType=BIT}, #{isTake,jdbcType=BIT}, #{isOrder,jdbcType=BIT},
    #{isHere,jdbcType=BIT}, #{instoreCode,jdbcType=CHAR}, #{miniOrderNum,jdbcType=INTEGER},
    #{specGroupId,jdbcType=BIGINT}, #{purchasingPrice,jdbcType=DECIMAL}, #{shippingPrice1,jdbcType=DECIMAL},
    #{shippingPrice2,jdbcType=DECIMAL}, #{isPricetag,jdbcType=TINYINT}, #{isCustomPrice,jdbcType=BIT},
    #{version,jdbcType=BIGINT}, #{brandId,jdbcType=BIGINT}, #{localId,jdbcType=BIGINT},
    #{saleOpenPrice,jdbcType=DECIMAL},#{combinationType,jdbcType=TINYINT})
  </insert>

  <update id="update" parameterType="map" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Nov 04 15:05:01 CST 2016.
    -->
    update goods
    <set >
      <if test="tenantId != null" >
        tenant_id = #{tenantId,jdbcType=BIGINT},
      </if>
      <if test="branchId != null" >
        branch_id = #{branchId,jdbcType=BIGINT},
      </if>
      <if test="categoryId != null" >
        category_id = #{categoryId,jdbcType=BIGINT},
      </if>
      <if test="categoryName != null" >
        category_name = #{categoryName,jdbcType=VARCHAR},
      </if>
      <if test="goodsCode != null" >
        goods_code = #{goodsCode,jdbcType=CHAR},
      </if>
      <if test="goodsName != null" >
        goods_name = #{goodsName,jdbcType=VARCHAR},
      </if>
      <if test="shortName != null" >
        short_name = #{shortName,jdbcType=VARCHAR},
      </if>
      <if test="goodsUnitId != null" >
        goods_unit_id = #{goodsUnitId,jdbcType=BIGINT},
      </if>
      <if test="goodsUnitName != null" >
        goods_unit_name = #{goodsUnitName,jdbcType=VARCHAR},
      </if>
      <if test="barCode != null" >
        bar_code = #{barCode,jdbcType=VARCHAR},
      </if>
      <if test="mnemonic != null" >
        mnemonic = #{mnemonic,jdbcType=VARCHAR},
      </if>
      <if test="westName != null" >
        west_name = #{westName,jdbcType=VARCHAR},
      </if>
      <if test="spec != null" >
        spec = #{spec,jdbcType=VARCHAR},
      </if>
      <if test="salePrice != null" >
        sale_price = #{salePrice,jdbcType=DECIMAL},
      </if>
      <if test="vipPrice != null" >
        vip_price = #{vipPrice,jdbcType=DECIMAL},
      </if>
      <if test="vipPrice2 != null" >
        vip_price2 = #{vipPrice2,jdbcType=DECIMAL},
      </if>
      <if test="goodsStatus != null" >
        goods_status = #{goodsStatus,jdbcType=TINYINT},
      </if>
      <if test="isDsc != null" >
        is_dsc = #{isDsc,jdbcType=BIT},
      </if>
      <if test="isLowerfee != null" >
        is_lowerfee = #{isLowerfee,jdbcType=BIT},
      </if>
      <if test="isTemp != null" >
        is_temp = #{isTemp,jdbcType=BIT},
      </if>
      <if test="isGiveticket != null" >
        is_giveticket = #{isGiveticket,jdbcType=BIT},
      </if>
      <if test="isUseticket != null" >
        is_useticket = #{isUseticket,jdbcType=BIT},
      </if>
      <if test="isScore != null" >
        is_score = #{isScore,jdbcType=BIT},
      </if>
      <if test="scoreValue != null" >
        score_value = #{scoreValue,jdbcType=DECIMAL},
      </if>
      <if test="isChangeprice != null" >
        is_changeprice = #{isChangeprice,jdbcType=BIT},
      </if>
      <if test="isModifynum != null" >
        is_modifynum = #{isModifynum,jdbcType=BIT},
      </if>
      <if test="isRevisedPrice != null" >
        is_revised_price = #{isRevisedPrice,jdbcType=BIT},
      </if>
      <if test="takeoutPrice != null" >
        takeout_price = #{takeoutPrice,jdbcType=DECIMAL},
      </if>
      <if test="photo != null" >
        photo = #{photo,jdbcType=VARCHAR},
      </if>
      <if test="goodsDesc != null" >
        goods_desc = #{goodsDesc,jdbcType=VARCHAR},
      </if>
      <if test="tag != null" >
        tag = #{tag,jdbcType=VARCHAR},
      </if>
      <if test="isServicefee != null" >
        is_servicefee = #{isServicefee,jdbcType=BIT},
      </if>
      <if test="isSertc != null" >
        is_sertc = #{isSertc,jdbcType=BIT},
      </if>
      <if test="isSaletc != null" >
        is_saletc = #{isSaletc,jdbcType=BIT},
      </if>
      <if test="saleTctype != null" >
        sale_tctype = #{saleTctype,jdbcType=TINYINT},
      </if>
      <if test="saleTcrate != null" >
        sale_tcrate = #{saleTcrate,jdbcType=DECIMAL},
      </if>
      <if test="saleTctotal != null" >
        sale_tctotal = #{saleTctotal,jdbcType=DECIMAL},
      </if>
      <if test="isMuchspec != null" >
        is_muchspec = #{isMuchspec,jdbcType=BIT},
      </if>
      <if test="weight != null" >
        weight = #{weight,jdbcType=DECIMAL},
      </if>
      <if test="isStore != null" >
        is_store = #{isStore,jdbcType=BIT},
      </if>
      <if test="priceType != null" >
        price_type = #{priceType,jdbcType=TINYINT},
      </if>
      <if test="isWeigh != null" >
        is_weigh = #{isWeigh,jdbcType=BIT},
      </if>
      <if test="isForPoints != null" >
        is_for_points = #{isForPoints,jdbcType=BIT},
      </if>
      <if test="pointsValue != null" >
        points_value = #{pointsValue,jdbcType=DECIMAL},
      </if>
      <if test="isRanked != null" >
        is_ranked = #{isRanked,jdbcType=BIT},
      </if>
      <if test="isRecommended != null" >
        is_recommended = #{isRecommended,jdbcType=BIT},
      </if>
      <if test="memo != null" >
        memo = #{memo,jdbcType=VARCHAR},
      </if>
      <if test="createBy != null" >
        create_by = #{createBy,jdbcType=VARCHAR},
      </if>
      <if test="createAt != null" >
        create_at = #{createAt,jdbcType=TIMESTAMP},
      </if>
      <if test="lastUpdateBy != null" >
        last_update_by = #{lastUpdateBy,jdbcType=VARCHAR},
      </if>
      <if test="lastUpdateAt != null" >
        last_update_at = #{lastUpdateAt,jdbcType=TIMESTAMP},
      </if>
      <if test="isDeleted != null" >
        is_deleted = #{isDeleted,jdbcType=BIT},
      </if>
      <if test="goodsType != null" >
        goods_type = #{goodsType,jdbcType=TINYINT},
      </if>
      <if test="isHotgood != null" >
        is_hotgood = #{isHotgood,jdbcType=BIT},
      </if>
      <if test="isNewgood != null" >
        is_newgood = #{isNewgood,jdbcType=BIT},
      </if>
      <if test="isTakeout != null" >
        is_takeout = #{isTakeout,jdbcType=BIT},
      </if>
      <if test="isTake != null" >
        is_take = #{isTake,jdbcType=BIT},
      </if>
      <if test="isOrder != null" >
        is_order = #{isOrder,jdbcType=BIT},
      </if>
      <if test="isHere != null" >
        is_here = #{isHere,jdbcType=BIT},
      </if>
      <if test="instoreCode != null" >
        instore_code = #{instoreCode,jdbcType=CHAR},
      </if>
      <if test="miniOrderNum != null" >
        mini_order_num = #{miniOrderNum,jdbcType=INTEGER},
      </if>
      <if test="specGroupId != null" >
        spec_group_id = #{specGroupId,jdbcType=BIGINT},
      </if>
      <if test="purchasingPrice != null" >
        purchasing_price = #{purchasingPrice,jdbcType=DECIMAL},
      </if>
      <if test="shippingPrice1 != null" >
        shipping_price1 = #{shippingPrice1,jdbcType=DECIMAL},
      </if>
      <if test="shippingPrice2 != null" >
        shipping_price2 = #{shippingPrice2,jdbcType=DECIMAL},
      </if>
      <if test="isPricetag != null" >
        is_pricetag = #{isPricetag,jdbcType=TINYINT},
      </if>
      <if test="isCustomPrice != null" >
        is_custom_price = #{isCustomPrice,jdbcType=BIT},
      </if>
      <if test="version != null" >
        version = #{version,jdbcType=BIGINT},
      </if>
      <if test="brandId != null" >
        brand_id = #{brandId,jdbcType=BIGINT},
      </if>
      <if test="localId != null" >
        local_id = #{localId,jdbcType=BIGINT},
      </if>
      <if test="saleOpenPrice != null" >
        sale_open_price = #{saleOpenPrice,jdbcType=DECIMAL},
      </if>
      <if test="combinationType != null" >
        combination_type = #{combinationType,jdbcType=TINYINT},
      </if>
    </set>
    where id = #{id,jdbcType=BIGINT}
  </update>
  <select id="queryPackage" resultType="mapUnderscoreToCamelCase">
    SELECT * FROM goods g WHERE g.tenant_id=${tenantId} AND g.is_deleted=0 AND g.goods_type=2
    <if test="goodsCodeOrName != null and goodsCodeOrName!=''" >
      AND (g.goods_code like '%${goodsCodeOrName}%' or g.goods_name like '%${goodsCodeOrName}%' or g.mnemonic like '%${goodsCodeOrName}%' OR  g.bar_code LIKE '%${goodsCodeOrName}%')
    </if>
    <if test="goodsStatus != null and goodsStatus!=''" >
      AND g.goods_status= #{goodsStatus}
    </if>
    <if test="onlySelf == 0">
      AND (g.branch_id=${branchId} OR g.branch_id=(SELECT id FROM branch WHERE tenant_id=${tenantId} AND branch_type=0))
    </if>
    <if test="onlySelf == 1">
      AND g.branch_id = ${branchId}
    </if>
    <if test="offset != null and rows != null">
      LIMIT ${offset},${rows}
    </if>
  </select>
  <select id="queryPackageSum" resultType="Long">
    SELECT count(1) FROM goods g WHERE g.tenant_id=${tenantId} AND g.is_deleted=0 AND g.goods_type=2
    <if test="goodsCodeOrName != null and goodsCodeOrName!=''" >
      AND (g.goods_code like '%${goodsCodeOrName}%' or g.goods_name like '%${goodsCodeOrName}%' or g.mnemonic like '%${goodsCodeOrName}%')
    </if>
    <if test="goodsStatus != null and goodsStatus!=''" >
      AND g.goods_status= #{goodsStatus}
    </if>
    <if test="onlySelf == 0">
      AND (g.branch_id=${branchId} OR g.branch_id=(SELECT id FROM branch WHERE tenant_id=${tenantId} AND branch_type=0))
    </if>
    <if test="onlySelf == 1">
      AND g.branch_id = ${branchId}
    </if>
  </select>
  <select id="getPackageById" resultType="erp.chain.domain.Goods">
    SELECT * FROM  goods WHERE tenant_id=${tenantId} AND id=#{id} AND is_deleted=0
  </select>
  <select id="getPackageCode" resultType="String">
    SELECT MAX(b.goods_code) FROM goods b where b.tenant_id=${tenantId} and b.goods_type=2 AND b.is_deleted=0
  </select>

  <!--<select id="queryGoodsListSum" resultType="Long">
<select id="queryGoodsWithStoreInfoList" resultType="mapUnderscoreToCamelCase">
  SELECT g.*,s.quantity
  FROM (SELECT * FROM store WHERE tenant_id =${tenantId}  AND branch_id =${branchId} AND is_deleted = 0) s
  INNER JOIN  goods g ON g.id = s.goods_id AND g.is_deleted = 0
  <if test="categoryId != null and categoryId!=''">
    AND g.category_id IN (SELECT id FROM  category c where c.tenant_id=${tenantId} and (c.id=#{categoryId} or c.parent_id=#{categoryId}))
  </if>
  LIMIT ${offset},${rows}
</select>
<select id="queryGoodsWithStoreInfoListSum" resultType="Long">
  SELECT COUNT(1) total
  FROM (SELECT * FROM store WHERE tenant_id =${tenantId}  AND branch_id =${branchId} AND is_deleted = 0) s
  INNER JOIN goods g ON g.id = s.goods_id AND g.is_deleted = 0
  <if test="categoryId != null and categoryId!=''">
    AND g.category_id IN (SELECT id FROM  category c where c.tenant_id=${tenantId} and (c.id=#{categoryId} or c.parent_id=#{categoryId}))
  </if>
</select>



<select id="sumGoodsStore" resultType="BigDecimal">
  SELECT SUM(quantity) FROM store WHERE goods_id=#{goodsId} AND tenant_id=${tenantId} AND branch_id=${branchId} AND is_deleted=0
</select>
<select id="countGroupGoods" resultType="Long">
  SELECT count(1) FROM group_goods WHERE goods_id=#{goodsId} AND tenant_id=${tenantId} AND branch_id=${branchId} AND is_deleted=0
</select>
<select id="countMenuGoods" resultType="Long">
  SELECT count(1) FROM menu_goods WHERE goods_id=#{goodsId} AND tenant_id=${tenantId} AND is_deleted=0
</select>
<select id="countDiet" resultType="Long">
  SELECT count(1) FROM diet_promotion_goods_r WHERE goods_id=#{goodsId} AND is_use=1 AND is_deleted=0
</select>
<select id="countRelation" resultType="Long">
  SELECT count(1) FROM goods_produce_relation
  WHERE tenant_id=${tenantId}
  AND (produce_goods_id=${goodsId} or goods_id=${goodsId})
  AND is_deleted=0;
</select>-->
</mapper>