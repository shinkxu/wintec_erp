<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="erp.chain.mapper.SaleMapper" >
  <resultMap id="BaseResultMap" type="erp.chain.domain.Sale" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Nov 04 15:05:01 CST 2016.
    -->
    <id column="id" property="id" jdbcType="BIGINT" />
    <result column="client_id" property="clientId" jdbcType="BIGINT" />
    <result column="tenant_id" property="tenantId" jdbcType="BIGINT" />
    <result column="branch_id" property="branchId" jdbcType="BIGINT" />
    <result column="sale_code" property="saleCode" jdbcType="CHAR" />
    <result column="pos_id" property="posId" jdbcType="BIGINT" />
    <result column="sale_mode" property="saleMode" jdbcType="TINYINT" />
    <result column="pos_code" property="posCode" jdbcType="CHAR" />
    <result column="table_id" property="tableId" jdbcType="BIGINT" />
    <result column="total_amount" property="totalAmount" jdbcType="DECIMAL" />
    <result column="discount_amount" property="discountAmount" jdbcType="DECIMAL" />
    <result column="give_amount" property="giveAmount" jdbcType="DECIMAL" />
    <result column="trunc_amount" property="truncAmount" jdbcType="DECIMAL" />
    <result column="is_free_of_charge" property="isFreeOfCharge" jdbcType="BIT" />
    <result column="service_fee" property="serviceFee" jdbcType="DECIMAL" />
    <result column="received_amount" property="receivedAmount" jdbcType="DECIMAL" />
    <result column="order_attendant" property="orderAttendant" jdbcType="VARCHAR" />
    <result column="service_attendant" property="serviceAttendant" jdbcType="VARCHAR" />
    <result column="table_open_at" property="tableOpenAt" jdbcType="TIMESTAMP" />
    <result column="open_attendant" property="openAttendant" jdbcType="VARCHAR" />
    <result column="cashier" property="cashier" jdbcType="BIGINT" />
    <result column="checkout_at" property="checkoutAt" jdbcType="TIMESTAMP" />
    <result column="promotion_id" property="promotionId" jdbcType="BIGINT" />
    <result column="is_refund" property="isRefund" jdbcType="INTEGER" />
    <result column="order_status" property="orderStatus" jdbcType="TINYINT" />
    <result column="delivery_status" property="deliveryStatus" jdbcType="TINYINT" />
    <result column="sale_order_code" property="saleOrderCode" jdbcType="CHAR" />
    <result column="create_by" property="createBy" jdbcType="VARCHAR" />
    <result column="create_at" property="createAt" jdbcType="TIMESTAMP" />
    <result column="last_update_by" property="lastUpdateBy" jdbcType="VARCHAR" />
    <result column="last_update_at" property="lastUpdateAt" jdbcType="TIMESTAMP" />
    <result column="is_deleted" property="isDeleted" jdbcType="BIT" />
    <result column="sale_type" property="saleType" jdbcType="TINYINT" />
    <result column="long_amount" property="longAmount" jdbcType="DECIMAL" />
    <result column="local_id" property="localId" jdbcType="BIGINT" />
    <result column="change_amount" property="changeAmount" jdbcType="DECIMAL" />
    <result column="local_sign" property="localSign" jdbcType="VARCHAR" />
  </resultMap>

  <insert id="insert" parameterType="map" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Nov 04 15:05:01 CST 2016.
    -->
    insert into sale (id, client_id, tenant_id, 
      branch_id, sale_code, pos_id, 
      sale_mode, pos_code, table_id, 
      total_amount, discount_amount, give_amount, 
      trunc_amount, is_free_of_charge, service_fee, 
      received_amount, order_attendant, service_attendant, 
      table_open_at, open_attendant, cashier, 
      checkout_at, promotion_id, is_refund, 
      order_status, delivery_status, sale_order_code, 
      create_by, create_at, last_update_by, 
      last_update_at, is_deleted, sale_type, 
      long_amount, local_id, change_amount,local_sign,vip_id,guide_id,trans_terminal,pay_type
      )
    values (#{id,jdbcType=BIGINT}, #{clientId,jdbcType=BIGINT}, #{tenantId,jdbcType=BIGINT}, 
      #{branchId,jdbcType=BIGINT}, #{saleCode,jdbcType=CHAR}, #{posId,jdbcType=BIGINT}, 
      #{saleMode,jdbcType=TINYINT}, #{posCode,jdbcType=CHAR}, #{tableId,jdbcType=BIGINT}, 
      #{totalAmount,jdbcType=DECIMAL}, #{discountAmount,jdbcType=DECIMAL}, #{giveAmount,jdbcType=DECIMAL}, 
      #{truncAmount,jdbcType=DECIMAL}, #{isFreeOfCharge,jdbcType=BIT}, #{serviceFee,jdbcType=DECIMAL}, 
      #{receivedAmount,jdbcType=DECIMAL}, #{orderAttendant,jdbcType=VARCHAR}, #{serviceAttendant,jdbcType=VARCHAR}, 
      #{tableOpenAt,jdbcType=TIMESTAMP}, #{openAttendant,jdbcType=VARCHAR}, #{cashier,jdbcType=BIGINT}, 
      #{checkoutAt,jdbcType=TIMESTAMP}, #{promotionId,jdbcType=BIGINT}, #{isRefund,jdbcType=INTEGER},
      #{orderStatus,jdbcType=TINYINT}, #{deliveryStatus,jdbcType=TINYINT}, #{saleOrderCode,jdbcType=CHAR}, 
      #{createBy,jdbcType=VARCHAR}, #{createAt,jdbcType=TIMESTAMP}, #{lastUpdateBy,jdbcType=VARCHAR}, 
      #{lastUpdateAt,jdbcType=TIMESTAMP}, #{isDeleted,jdbcType=BIT}, #{saleType,jdbcType=TINYINT}, 
      #{longAmount,jdbcType=DECIMAL}, #{localId,jdbcType=BIGINT}, #{changeAmount,jdbcType=DECIMAL},
      #{localSign,jdbcType=VARCHAR},#{vipId,jdbcType=BIGINT},#{guideId,jdbcType=BIGINT},
      #{transTerminal,jdbcType=TINYINT},#{payType,jdbcType=TINYINT}
      )
  </insert>

  <update id="update" parameterType="map" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Nov 04 15:05:01 CST 2016.
    -->
    update sale
    <set >
      <if test="clientId != null" >
        client_id = #{clientId,jdbcType=BIGINT},
      </if>
      <if test="tenantId != null" >
        tenant_id = #{tenantId,jdbcType=BIGINT},
      </if>
      <if test="branchId != null" >
        branch_id = #{branchId,jdbcType=BIGINT},
      </if>
      <if test="saleCode != null" >
        sale_code = #{saleCode,jdbcType=CHAR},
      </if>
      <if test="posId != null" >
        pos_id = #{posId,jdbcType=BIGINT},
      </if>
      <if test="saleMode != null" >
        sale_mode = #{saleMode,jdbcType=TINYINT},
      </if>
      <if test="posCode != null" >
        pos_code = #{posCode,jdbcType=CHAR},
      </if>
      <if test="tableId != null" >
        table_id = #{tableId,jdbcType=BIGINT},
      </if>
      <if test="totalAmount != null" >
        total_amount = #{totalAmount,jdbcType=DECIMAL},
      </if>
      <if test="discountAmount != null" >
        discount_amount = #{discountAmount,jdbcType=DECIMAL},
      </if>
      <if test="giveAmount != null" >
        give_amount = #{giveAmount,jdbcType=DECIMAL},
      </if>
      <if test="truncAmount != null" >
        trunc_amount = #{truncAmount,jdbcType=DECIMAL},
      </if>
      <if test="isFreeOfCharge != null" >
        is_free_of_charge = #{isFreeOfCharge,jdbcType=BIT},
      </if>
      <if test="serviceFee != null" >
        service_fee = #{serviceFee,jdbcType=DECIMAL},
      </if>
      <if test="receivedAmount != null" >
        received_amount = #{receivedAmount,jdbcType=DECIMAL},
      </if>
      <if test="orderAttendant != null" >
        order_attendant = #{orderAttendant,jdbcType=VARCHAR},
      </if>
      <if test="serviceAttendant != null" >
        service_attendant = #{serviceAttendant,jdbcType=VARCHAR},
      </if>
      <if test="tableOpenAt != null" >
        table_open_at = #{tableOpenAt,jdbcType=TIMESTAMP},
      </if>
      <if test="openAttendant != null" >
        open_attendant = #{openAttendant,jdbcType=VARCHAR},
      </if>
      <if test="cashier != null" >
        cashier = #{cashier,jdbcType=BIGINT},
      </if>
      <if test="checkoutAt != null" >
        checkout_at = #{checkoutAt,jdbcType=TIMESTAMP},
      </if>
      <if test="promotionId != null" >
        promotion_id = #{promotionId,jdbcType=BIGINT},
      </if>
      <if test="isRefund != null" >
        is_refund = #{isRefund,jdbcType=INTEGER},
      </if>
      <if test="orderStatus != null" >
        order_status = #{orderStatus,jdbcType=TINYINT},
      </if>
      <if test="deliveryStatus != null" >
        delivery_status = #{deliveryStatus,jdbcType=TINYINT},
      </if>
      <if test="saleOrderCode != null" >
        sale_order_code = #{saleOrderCode,jdbcType=CHAR},
      </if>
      <if test="createBy != null" >
        create_by = #{createBy,jdbcType=VARCHAR},
      </if>
      <if test="createAt != null" >
        create_at = #{createAt,jdbcType=TIMESTAMP},
      </if>
      <if test="lastUpdateBy != null" >
        last_update_by = #{lastUpdateBy,jdbcType=VARCHAR},
      </if>
      <if test="lastUpdateAt != null" >
        last_update_at = #{lastUpdateAt,jdbcType=TIMESTAMP},
      </if>
      <if test="isDeleted != null" >
        is_deleted = #{isDeleted,jdbcType=BIT},
      </if>
      <if test="saleType != null" >
        sale_type = #{saleType,jdbcType=TINYINT},
      </if>
      <if test="longAmount != null" >
        long_amount = #{longAmount,jdbcType=DECIMAL},
      </if>
      <if test="localId != null" >
        local_id = #{localId,jdbcType=BIGINT},
      </if>
      <if test="changeAmount != null" >
        change_amount = #{changeAmount,jdbcType=DECIMAL},
      </if>
      <if test="localSign != null" >
        local_sign = #{localSign,jdbcType=VARCHAR},
      </if>
      <if test="vipId != null" >
        vip_id = #{vipId,jdbcType=VARCHAR},
      </if>
    </set>
    where id = #{id,jdbcType=BIGINT}
  </update>
<select id="getMaxSaleCode" resultType="String">
  select IFNULL(max(s.sale_code),"") from sale s where s.tenant_id=${tenantId} AND s.branch_id=#{branchId} AND s.checkout_at &gt;='${today} 00:00:00' AND s.pos_id=#{posId} and s.is_deleted=0
</select>
</mapper>